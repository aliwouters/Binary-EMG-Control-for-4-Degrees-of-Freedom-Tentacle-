#include <Servo.h>

Servo servo1;
Servo servo2;

void setup() {
  Serial.begin(9600);
  while (!Serial); // Wait for Leonardo's serial connection

  servo1.attach(3); // Connect Servo 1 to pin 3
  servo2.attach(5); // Connect Servo 2 to pin 5

  Serial.println("Arduino ready. Waiting for commands like M1:135;M2:90");
}

void loop() {
  static String inputString = "";
  
  // Read incoming serial data
  while (Serial.available()) {
    char c = Serial.read();
    if (c == '\n') {
      parseCommand(inputString);
      inputString = ""; // Reset for next command
    } else {
      inputString += c;
    }
  }
}

void parseCommand(String cmd) {
  int m1Index = cmd.indexOf("M1:");
  int m2Index = cmd.indexOf("M2:");

  if (m1Index != -1 && m2Index != -1) {
    int angle1 = cmd.substring(m1Index + 3, cmd.indexOf(';')).toInt();
    int angle2 = cmd.substring(m2Index + 3).toInt();

    angle1 = constrain(angle1, 0, 180);
    angle2 = constrain(angle2, 0, 180);

    servo1.write(angle1);
    servo2.write(angle2);

    Serial.print("Set Servo 1 to ");
    Serial.print(angle1);
    Serial.print("°, Servo 2 to ");
    Serial.print(angle2);
    Serial.println("°");
  } else {
    Serial.println("Invalid command. Format: M1:<angle>;M2:<angle>");
  }
}
